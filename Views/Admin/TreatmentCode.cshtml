@model IEnumerable<E_PRESCRIBING_SYSTEM.Models.TreatmentCode>
@{
    ViewData["Title"] = "AddMedication";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<head>
    <link rel="stylesheet" href="~/css/AddMedicationScreen.css" />
</head>
<br />
<br />
<body>
    <div>
        <a href='@Url.Action("AdminDashboard", "Admin")'>Back</a>
    </div>
    <form asp-action="AddTreatmentCode" method="post">
        <h2>Add Treatment Codes</h2>
        <div class="icon-button" onclick="openModal('listTeatmentCodeModal')">
            <img src="~/css/Theatre.png" alt="Reports">
            <p>Treatment Code</p>
        </div>
        <div class="form-group">
            <label for="Code"> Treatment Code:</label>
            <input type="text" id="Code" name="Code" required />
        </div>
        <div class="form-group">
            <label for="Description"> Description:</label>
            <input type="text" id="Description" name="Description" required />
        </div>
        <div class="form-group">
            <button type="submit">Submit</button>
        </div>
    </form>
    <!-- list Active Ingredients Stock Modal -->
    <div id="listTeatmentCodeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('listTeatmentCodeModal')">&times;</span>
            <!-- Active Ingredient table content -->
            <h2>List Of Treatment</h2>

            <form id="searchForm" asp-action=" SearchTreatmentCode" asp-controller="Admin" method="get">
                <input type="text" name="searchText" placeholder="Search">
                <input type="submit" value="Search">
            </form>




            <div class="form-container">

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Treatment ID</th>
                                <th>Treatment Code</th>
                                <th>Description</th>
                             
                            </tr>
                        </thead>
                        <tbody id="searchResults">

                            @if (Model != null && Model.Any())
                                @foreach (var med in Model)
                                {
                                    <tr>
                                        <td>@med.TreatmentID</td>
                                        <td>@med.Code</td>
                                        <td>@med.Description</td>


                                       
                                            @*  <td>
                                <div class="btn-group btn-group-sm">
                                <a asp-controller="ChronicNurse" asp-action="ViewVital" asp-route-id="@vital.VitalId" class="btn btn-danger">Edit</a>
                                </div>
                                </td> *@
                                    </tr>
                                }

                            else
                            {
                                <tr>
                                    <td colspan="3">No results found.</td>
                                </tr>

                            }


                        </tbody>
                    </table>


                    <!-- Update Treatment Code Modal -->
                    <div id="updateTreatmentModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal('updateTreatmentModal')">&times;</span>
                            <h2>Update Treatment Code</h2>

                            <form id="updateTreatmentForm">
                                <input type="hidden" id="updateTreatmentID" name="TreatmentID" />
                                <div class="form-group">
                                    <label for="Code">Treatment Code:</label>
                                    <input type="text" id="Code" name="Code"  />
                                </div>
                                <div class="form-group">
                                    <label for="Description">Description:</label>
                                    <input type="text" id="Description" name="Description" />
                                </div>
                                <div class="form-group">
                                    <button type="submit">Update</button>
                                </div>
                            </form>
                        </div>
                    </div>




                    <!-- Delete Confirmation Modal -->
                    <div id="deleteConfirmationModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal('deleteConfirmationModal')">&times;</span>
                            <h2>Are you sure you want to delete this treatment code?</h2>
                            <form id="deleteTreatmentForm">
                                <input type="hidden" id="deleteTreatmentID" name="TreatmentID" />
                                <div class="form-group">
                                    <button type="submit">Yes, Delete</button>
                                    <button type="button" onclick="closeModal('deleteConfirmationModal')">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>



                    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

                    <script>
                        $(document).ready(function () {
                            $('#searchForm').submit(function (e) {
                                e.preventDefault(); // Prevent the default form submission

                                $.ajax({
                                    type: 'GET',
                                    url: $(this).attr('action'),
                                    data: $(this).serialize(),
                                    success: function (response) {
                                        // Replace the contents of #searchResults with the search results
                                        $('#searchResults').html(response);
                                    },
                                    error: function () {
                                        alert('An error occurred while searching.');
                                    }
                                });
                            });
                        });
                    </script>
                    <script>
                        // Function to open the Update modal with treatment details
                        function openUpdateModal(treatmentID) {
                            $.ajax({
                                url: '/Admin/GetTreatmentById', // This should return treatment data by ID
                                type: 'GET',
                                data: { id: treatmentID },
                                success: function (treatment) {
                                    // Fill the modal with treatment details
                                    $('#updateTreatmentID').val(treatment.TreatmentID);
                                    $('#updateCode').val(treatment.Code);
                                    $('#updateDescription').val(treatment.Description);
                                    $('#updateTreatmentModal').show();
                                },
                                error: function () {
                                    alert('Error loading treatment data.');
                                }
                            });
                        }

                        // Handle Update Treatment form submission via AJAX
                        $('#updateTreatmentForm').submit(function (e) {
                            e.preventDefault();

                            $.ajax({
                                url: '/Admin/UpdateTreatment', // The action to update treatment
                                type: 'POST',
                                data: $(this).serialize(),
                                success: function (response) {
                                    if (response.success) {
                                        alert('Treatment updated successfully!');
                                        location.reload(); // Reload the page to reflect changes
                                    } else {
                                        alert('Failed to update treatment.');
                                    }
                                },
                                error: function () {
                                    alert('Error during update.');
                                }
                            });
                        });

                        // Function to open the Delete confirmation modal
                        function openDeleteModal(treatmentID) {
                            $('#deleteTreatmentID').val(treatmentID);
                            $('#deleteConfirmationModal').show();
                        }

                        // Handle Delete Treatment form submission via AJAX
                        $('#deleteTreatmentForm').submit(function (e) {
                            e.preventDefault();

                            $.ajax({
                                url: '/Admin/DeleteTreatment', // The action to delete treatment
                                type: 'POST',
                                data: $(this).serialize(),
                                success: function (response) {
                                    if (response.success) {
                                        alert('Treatment deleted successfully!');
                                        location.reload(); // Reload the page to reflect changes
                                    } else {
                                        alert('Failed to delete treatment.');
                                    }
                                },
                                error: function () {
                                    alert('Error during deletion.');
                                }
                            });
                        });

                        // Close modal function
                        function closeModal(modalId) {
                            document.getElementById(modalId).style.display = "none";
                        }
                    </script>


                    <script>
                        function openModal(modalId) {
                            document.getElementById(modalId).style.display = "block";
                        }

                        function closeModal(modalId) {
                            document.getElementById(modalId).style.display = "none";
                        }

                        function addIngredient() {
                            const container = document.getElementById('activeIngredientsContainer');
                            const newIngredientRow = document.createElement('div');
                            newIngredientRow.classList.add('ingredient-row');
                            newIngredientRow.innerHTML = `
                                                                                                                   <select id="activeIngredientName" name="activeIngredients[]" placeholder="Ingredient Name" required>
                                                                    <%: GenerateIngredientOptions() %>
                                                                </select>
                                                                                                                <input type="text" name="ingredientStrength[]" placeholder="Strength" required>
                                                                                                        <button type="button" onclick="removeIngredient(this)">Remove</button>
                                                                                                    `;
                            container.appendChild(newIngredientRow);
                        }

                        function removeIngredient(button) {
                            const row = button.parentElement;
                            row.remove();
                        }

                        document.getElementById('medicationForm').addEventListener('submit', function (event) {
                            event.preventDefault();
                            alert('Medication added successfully!');
                            // Here you can add the code to handle the form data
                        });
                    </script>


                </div>
            </div>
        </div>
    </div>


   

</body>